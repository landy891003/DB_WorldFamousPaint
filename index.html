<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>World Famous Painting</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" type="text/css" href="css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <!-- owl stylesheets --> 
      <!-- <link rel="stylesheet" href="css/owl.carousel.min.css"> -->
      <link rel="stylesoeet" href="css/owl.theme.default.min.css">
      <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen"> -->

   </head>
   <body>
 
      <div class="header_section">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="logo" href="index.html"></a>
      <button  class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
         <ul class="navbar-nav mr-auto">
         <li class="nav-item"></li>
         </ul>
      </div>
      </nav>
      </div>
      <div class="banner_section layout_padding">
      <div id="main_slider" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner">
      <div class="carousel-item active">
      <div class="container">
         <h1 class="banner_taital">World<br>Famous Painting</br></h1>
         <div class="more_bt"><a href="#Search" onclick="ListPaint()">Search Painting</a></div>
      </div>
      </div>
      </div>
      </div>
      <a class="carousel-control-prev" href="#main_slider" role="button" data-slide="prev">
         <i class="fa fa-left"><img src="images/left-icon.png"></i>
      </a>
      <a class="carousel-control-next" href="#main_slider" role="button" data-slide="next">
         <i class="fa fa-right"><img src="images/right-icon.png"></i>
      </a>
      </div>
      </div>
      <!-- project section start -->
      <div id = "Search" class="project_section layout_padding">
         <div class="container">
            <h1 class="project_taital">世界名畫檔案</h1>
            <div class="project_menu">
               <ul id ="menu">
                  <li class="active"><a>色系</a></li><li>
                     <div class="hsl-container">
                        <div class="hsl-selector">
                           <div class="input-container">
                           <label for="h-range">Hue:  </label>
                           0    <input type="range" id="h-range" value="0" min="0" max="360" step="1"> 360
                           </div>
                     </div>   
                     <p id="hsl-display"><span id="h-value">0</span></p>

                  </li>
                  <li class="active"><a onclick="ColorSearch()">Search</a></li>
                  <!-- <li class="active"><a>物件</a></li>
                  <li><a href="#">樹</a></li>
                  <li><a href="#">水</a></li>
                  <li><a href="#">男人</a></li>
                  <li><a href="#">女人</a></li> -->
               </ul>

               <div class="input-group">
                  <input id='SearchInput' type="text" class="form-control" aria-label="Text input with segmented dropdown button">
                  <div class="input-group-append">
                    <button id= "SearchType" type="button" class="btn btn-outline-secondary">搜尋作品名稱</button>
                    <button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <div id='Type'class="dropdown-menu" >
                      <a id="1" class="dropdown-item">搜尋作者</a>
                      <a id="2"class="dropdown-item">搜尋年代</a>
                      <a id="3"class="dropdown-item">搜尋屬性</a>

                     </div>
                  </div>
                </div>
            </div>
         </div>

         <div class="project_section_2 layout_padding">
            <div class="container-fluid">
                  <div style=" display: flex;flex-wrap: wrap;justify-content: center;", id="Paint">
                  </div>
                  
            </div>
         </div>
      </div>
      <!-- copyright section start -->
      <div class="copyright_section">
         <div class="container">
            <p class="copyright_text">長庚資工資料庫設計 <a href="https://html.design"> 名畫資料庫</p>
         </div>
      </div>
      <script src="js/jquery.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script src="js/jquery-3.0.0.min.js"></script>
      <!-- <script src="js/plugin.js"></script> -->
      <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="js/custom.js"></script>
      <!-- <script src="js/owl.carousel.js"></script> -->
      <!-- <script src="https:cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script> -->
      <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-database.js"></script>
      <script>

      const firebaseConfig = {
         apiKey: "AIzaSyC-qCdMtnhauLVZSFnanEwg_A6aoFnAz44",
         authDomain: "painting-database.firebaseapp.com",
         databaseURL: "https://painting-database-default-rtdb.firebaseio.com",
         projectId: "painting-database",
         storageBucket: "painting-database.appspot.com",
         messagingSenderId: "269078974709",
         appId: "1:269078974709:web:580da754219d5bff20b5bc"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var btn = document.getElementById('SearchType')
      var div = document.getElementById('Paint')
      const hVal = document.getElementById("h-value");
      const hRange = document.getElementById("h-range");
      const background = document.getElementById("hsl-display");

      function ListPaint(){
         var Space = document.getElementById('Paint')
         var child = Space.lastElementChild; 

         while (child) {
               Space.removeChild(child);
               child = Space.lastElementChild;
         }
         var Ref = firebase.database().ref('Artwork').limitToFirst(23)
         Ref.once('value', function(snapshot) {
            snapshot.forEach(childSnapShot=>{
               var data = childSnapShot.val()
                  var img =new Image()
                  img.src= data.Image
                  img.width="300" 
                  img.height="300"
                  img.border="2"
                  img.onclick = function(){
                  window.location.href = `projects.html?id=${childSnapShot.key}`
                  }
                  div.appendChild(img); 

               })
            })
      }
      ListPaint()
      const setBackground = () => {
            const h = hRange.value;
            background.style.backgroundColor = `hsl(${h}, 50%, 50%)`;
            background.style.color = `hsl(${h}, 50%, 100%)`;
         };
      setBackground();
      const updateValue = (val, range) => {
            val.innerText = range.value;
            setBackground();
      };
      hRange.addEventListener("input",() => {
            updateValue(hVal, hRange);
         },false
      );
      function ColorSearch(){
         var Space = document.getElementById('Paint')
         var child = Space.lastElementChild; 
            while (child) {
               Space.removeChild(child);
               child = Space.lastElementChild;
         }
         var starCountRef = firebase.database().ref('Artwork');
         starCountRef.once('value', function(snapshot) {
            snapshot.forEach(childSnapShot=>{
               var data = childSnapShot.val()
               range= eval(data.Color)-eval(hVal.innerText)   
               if(Math.abs(range)<=10){
                  var img =new Image()
                  img.src= data.Image
                  img.width="300" 
                  img.height="300"
                  img.border="2"
                  img.onclick = function(){
                     window.location.href = `projects.html?id=${childSnapShot.key}`
                  }
                  div.appendChild(img); 
               }
            })
            if(div.childNodes.length === 1){
               alert('Not Found,Please Try agian')
            }
         })
      }
      var order = [0,1,2,3]
      $('#Type').click(function(){
         const temp = btn.textContent
         btn.textContent=$(event.target).text()
         var typechange = document.getElementById(event.target.id)

         typechange.textContent = temp
         var reg = order[0]
         order[0] = order[event.target.id]
         order[event.target.id]= reg
         
      })
      $('#SearchType').click(function(){
         var Space = document.getElementById('Paint')
         var child = Space.lastElementChild; 
            while (child) {
               Space.removeChild(child);
               child = Space.lastElementChild;
            }
            var starCountRef = firebase.database().ref('Artwork');
            var search_word = document.getElementById('SearchInput').value
            if(search_word==''){
               alert('Please enter keyword')
            }
            else{
            starCountRef.once('value', function(snapshot) {
            snapshot.forEach(childSnapShot=>{
               var data = childSnapShot.val()
               var CheckType=[data.Title,data.Artist,data.Date,data.Category]
                  if(CheckType[order[0]]==search_word){
                     var img =new Image()
                     img.src= data.Image
                     img.width="300" 
                     img.height="300"
                     img.border="2"
                     img.onclick = function(){
                     window.location.href = `projects.html?id=${childSnapShot.key}`
                     }
                     div.appendChild(img); 
                  }
               })
               if(div.childNodes.length ===1){
                  alert('NOT FOUND ! PLEASE TRY AGIAN')
               }
            })
            }
         })
</script>

   </body>
</html>